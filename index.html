<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Immersea - Pulse of the Sea</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #subtitle-bubble {
        position: absolute;
        bottom: 20%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 40, 90, 0.85);
        color: #fff;
        padding: 14px 24px;
        border-radius: 14px;
        font-size: 1.25em;
        max-width: 75vw;
        text-align: center;
        z-index: 10;
        transition: opacity 0.3s;
        pointer-events: none;
      }
      #subtitle-bubble.hidden {
        opacity: 0;
      }
      #playAudioBtn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 100;
        padding: 12px 18px;
        font-size: 1.1em;
        background: #003366;
        color: #fff;
        border: none;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <button id="playAudioBtn">Play Narration</button>
    <div id="subtitle-bubble" class="hidden"></div>
    <a-scene background="color: #1b355c" fog="type: linear; color: #16406b; near:1; far:20">
      <a-sky color="#16406b"></a-sky>
      <a-entity light="type: ambient; color: #2172b8; intensity: 1.2"></a-entity>
      <a-entity light="type: directional; color: #16406b; intensity: 0.25" position="0 10 0"></a-entity>
      <a-plane position="0 5 0" rotation="-90 0 0" width="100" height="100" color="#13568c" opacity="0.35"></a-plane>
      <a-assets>
        <audio id="narrationAudio" src="assets/narration_audio.mp3"></audio>
        <img id="phytoplanktonImg" src="assets/phytoplankton.jpg">
        <img id="satelliteImg1" src="assets/satellite_image_1.jpg">
        <img id="satelliteImg2" src="assets/satellite_image_2.jpg">
        <a-asset-item id="seaTurtleModel" src="assets/sea_turtle_low_poly.glb"></a-asset-item>
      </a-assets>
      <!-- Turtle: close to camera, centered, facing camera, slightly transparent -->
      <a-entity id="turtle" gltf-model="#seaTurtleModel" position="0 1 -6" rotation="0 180 0" scale="0.18 0.18 0.18"
        material="opacity: 0.88; transparent: true"
        animation="property: position; to: 0 2 -6; dir: alternate; loop: true; dur: 4000"></a-entity>
      <!-- Images spaced closer, not overlapping, slightly transparent -->
      <a-image src="#satelliteImg1" position="3 2 -5" rotation="0 15 0" width="2" height="1" opacity="0.82"></a-image>
      <a-image src="#satelliteImg2" position="-3 2 -5" rotation="0 -15 0" width="2" height="1" opacity="0.82"></a-image>
      <a-image src="#phytoplanktonImg" position="0 3 -3" rotation="0 0 0" width="2" height="1" opacity="0.82"></a-image>
      <!-- Underwater bubbles/particles -->
      <a-entity geometry="primitive: sphere; radius: 0.09" material="color: #b3e6ff; opacity: 0.16"
        position="2 1 -4" animation="property: position; to: 2 3 -4; dir: alternate; loop: true; dur: 3000"></a-entity>
      <a-entity geometry="primitive: sphere; radius: 0.07" material="color: #c2f0fa; opacity: 0.11"
        position="-3 0.7 -5" animation="property: position; to: -3 2 -5; dir: alternate; loop: true; dur: 3400"></a-entity>
      <a-entity geometry="primitive: sphere; radius: 0.05" material="color: #d7faff; opacity: 0.13"
        position="1 0.5 -2" animation="property: position; to: 1 2 -2; dir: alternate; loop: true; dur: 3200"></a-entity>
      <a-entity camera look-controls wasd-controls position="0 2 0"></a-entity>
      <a-entity id="audioTrigger" sound="src: url(assets/narration_audio.mp3); autoplay: false"></a-entity>
    </a-scene>
    <script>
      document.getElementById('playAudioBtn').onclick = function() {
        var audioEntity = document.querySelector('#audioTrigger');
        if (audioEntity && audioEntity.components.sound) {
          audioEntity.components.sound.playSound();
        }
      };
      document.body.addEventListener('click', function () {
        var audioEntity = document.querySelector('#audioTrigger');
        if (audioEntity && audioEntity.components.sound) {
          audioEntity.components.sound.playSound();
        }
      }, { once: true });
      setTimeout(() => {
        window.dispatchEvent(new CustomEvent('subtitle', {detail: {text: "Welcome to Immersea!"}}));
      }, 2000);
      window.addEventListener('subtitle', e => {
        const bubble = document.getElementById('subtitle-bubble');
        if (e.detail.text) {
          bubble.textContent = e.detail.text;
          bubble.classList.remove('hidden');
        } else {
          bubble.classList.add('hidden');
        }
      });
    </script>
  </body>
</html>